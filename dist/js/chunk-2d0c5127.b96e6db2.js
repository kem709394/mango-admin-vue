(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c5127"],{"3e10":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-list-box"}}),e._v("操作日志\n    ")],1),a("Row",[a("Col",{attrs:{span:"12"}},[a("Select",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{multiple:"",filterable:"",placeholder:"请选择用户..."},model:{value:e.searchForm.user,callback:function(t){e.$set(e.searchForm,"user",t)},expression:"searchForm.user"}},e._l(e.userOption,function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.userName))])}),1),a("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-search"},on:{click:e.handleSearch}}),a("Button",{attrs:{type:"text",size:"small",icon:"ios-funnel"},on:{click:e.handleFilter}}),a("Button",{attrs:{type:"text",size:"small",icon:"ios-refresh-circle"},on:{click:e.handleRefresh}}),e.$checkAccess("sys_operate_log_close")&&e.configState.operate?a("Button",{staticStyle:{"margin-left":"20px"},on:{click:e.handleClose}},[e._v("关闭")]):e._e(),e.$checkAccess("sys_operate_log_open")&&!e.configState.operate?a("Button",{staticStyle:{"margin-left":"20px"},on:{click:e.handleOpen}},[e._v("开启")]):e._e()],1),a("Col",{staticStyle:{"text-align":"right"},attrs:{span:"12"}},[e.$checkAccess("sys_operate_log_delete")?a("Button",{attrs:{type:"error",disabled:!e.deleteBatch},on:{click:e.handleDeleteBatch}},[e._v("删除")]):e._e()],1)],1),a("Row",e._l(e.searchTag,function(t,r){return a("Tag",{key:r},[e._v(e._s(t))])}),1),a("Row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:1}},[a("Table",{ref:"selection",attrs:{border:"",columns:e.columns,data:e.pageList,loading:e.pageLoading},on:{"on-selection-change":e.handleSelect}})],1),a("Row",{staticStyle:{"margin-top":"10px"}},[a("Page",{attrs:{current:e.pageNum,total:e.pageTotal,"page-size":e.pageRows,"show-sizer":""},on:{"on-change":e.handleChangePage,"on-page-size-change":e.handleChangePageSize}})],1)],1),a("Modal",{attrs:{title:"高级搜索"},on:{"on-ok":e.handleSearch},model:{value:e.searchVisible,callback:function(t){e.searchVisible=t},expression:"searchVisible"}},[a("Form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":100}},[a("FormItem",{attrs:{label:"用户"}},[a("Select",{staticStyle:{width:"300px"},attrs:{multiple:"",filterable:""},model:{value:e.searchForm.user,callback:function(t){e.$set(e.searchForm,"user",t)},expression:"searchForm.user"}},e._l(e.userOption,function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.userName))])}),1)],1),a("FormItem",{attrs:{label:"路径"}},[a("Input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"Enter something..."},model:{value:e.searchForm.path,callback:function(t){e.$set(e.searchForm,"path",t)},expression:"searchForm.path"}})],1),a("FormItem",{attrs:{label:"日期"}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"daterange",placeholder:"Select date"},model:{value:e.searchForm.daterange,callback:function(t){e.$set(e.searchForm,"daterange",t)},expression:"searchForm.daterange"}})],1)],1)],1),a("OperateLogDetail",{ref:"detailModal"})],1)},s=[],n=(a("8e6e"),a("456d"),a("ac6a"),a("bd86")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{title:"操作详情",width:"800","footer-hide":""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.detail?a("Form",{attrs:{"label-width":100}},[a("FormItem",{attrs:{label:"路径"}},[e._v(e._s(e.detail.path))]),a("FormItem",{attrs:{label:"方法"}},[e._v(e._s(e.detail.method))]),a("FormItem",{attrs:{label:"参数"}},[e._v(e._s(e.detail.parameters))]),a("FormItem",{attrs:{label:"地址"}},[e._v(e._s(e.detail.ipAddress))]),a("FormItem",{attrs:{label:"设备"}},[e._v(e._s(e.detail.device.browser)+"("+e._s(e.detail.device.system)+")")]),a("FormItem",{attrs:{label:"用户"}},[a("Avatar",{attrs:{src:e.detail.user.avatar}}),a("span",[e._v(e._s(e.detail.user.userName))])],1),a("FormItem",{attrs:{label:"时间"}},[e._v(e._s(e.$moment(e.detail.createTime).format("YYYY-MM-DD HH:mm")))]),a("FormItem",{attrs:{label:"鉴权"}},[e._v(e._s(e.detail.isAgreed?"通过":"拒绝"))]),a("FormItem",{attrs:{label:"返回"}},[a("div",{staticStyle:{width:"600px","word-break":"break-all","word-wrap":"break-word"}},[e._v(e._s(e.detail.response))])])],1):e._e()],1)},i=[],l=a("2f62");function c(e,t){var a=Object.keys(e);return Object.getOwnPropertySymbols&&a.push.apply(a,Object.getOwnPropertySymbols(e)),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(a,!0).forEach(function(t){Object(n["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var u={data:function(){return{visible:!1,detail:null}},methods:h({},Object(l["b"])("sys/operate_log",["getDetail"]),{init:function(e){var t=this;this.getDetail(e).then(function(e){t.detail=e.info,t.visible=!0})}})},p=u,g=a("2877"),d=Object(g["a"])(p,o,i,!1,null,null,null),m=d.exports;function f(e,t){var a=Object.keys(e);return Object.getOwnPropertySymbols&&a.push.apply(a,Object.getOwnPropertySymbols(e)),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(a,!0).forEach(function(t){Object(n["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var _={name:"sys_operate_log",components:{OperateLogDetail:m},data:function(){var e=this;return{deleteBatch:!1,searchVisible:!1,searchForm:{user:[],path:"",daterange:null},searchTag:[],columns:[{type:"selection",width:60,align:"center"},{title:"用户",render:function(e,t){return e("div",[e("Avatar",{props:{src:t.row.user.avatar}}),e("span",{style:"margin-left:10px"},t.row.user.userName)])}},{title:"路径",key:"path"},{title:"方法",key:"method"},{title:"地址",key:"ipAddress"},{title:"时间",render:function(t,a){return t("span",e.$moment(a.row.createTime).format("YYYY-MM-DD HH:mm"))}},{title:"鉴权",render:function(e,t){return e("span",t.row.isAgreed?"通过":"拒绝")}},{title:"操作",width:150,align:"center",render:function(t,a){var r=[];return e.$checkAccess("sys_operate_log_detail")&&r.push(t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.handleDetail(a.row)}}},"详情")),e.$checkAccess("sys_operate_log_delete")&&r.push(t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.handleDelete(a.row)}}},"删除")),t("div",r)}}],userOption:[],configState:{}}},computed:b({},Object(l["c"])("sys/operate_log",["pageFilter","pageNum","pageRows","pageList","pageTotal","pageLoading"])),mounted:function(){this.init()},methods:b({},Object(l["b"])("sys/operate_log",["getData","delete"]),{},Object(l["b"])("sys/config",{getConfig:"getContent",updateConfig:"updateContent"}),{},Object(l["b"])("sys/user",{getUserList:"getList"}),{},Object(l["d"])("sys/operate_log",["setPageNum","setPageRows","setPageFilter"]),{init:function(){var e=this;this.getData(),this.getConfig("LOG_CONFIG").then(function(t){e.configState=t.info}),this.getUserList({}).then(function(t){e.userOption=t.list})},handleSelect:function(){this.$refs.selection.getSelection().length>0?this.deleteBatch=!0:this.deleteBatch=!1},handleChangePage:function(e){this.setPageNum(e),this.getData()},handleChangePageSize:function(e){this.setPageNum(1),this.setPageRows(e),this.getData()},handleFilter:function(){this.searchVisible=!0},handleSearch:function(){var e=this;this.searchTag=[];var t={};if(this.searchForm.user.length>0){t.user=this.searchForm.user;var a="用户：";this.searchForm.user.forEach(function(t){e.userOption.forEach(function(e){t===e.id&&(a+=e.userName+" ")})}),this.searchTag.push(a)}""!==this.searchForm.path.trim()&&(t.path=this.searchForm.path.trim(),this.searchTag.push("路径："+this.searchForm.path.trim())),this.searchForm.daterange&&this.searchForm.daterange[0]&&(t.dateRange=this.searchForm.daterange,this.searchTag.push("日期："+this.$moment(this.searchForm.daterange[0]).format("YYYY-MM-DD")+"至"+this.$moment(this.searchForm.daterange[1]).format("YYYY-MM-DD"))),this.setPageFilter(t),this.setPageNum(1),this.getData()},handleRefresh:function(){this.searchTag=[],this.searchForm.user=[],this.searchForm.path="",this.searchForm.daterange=null,this.setPageFilter({}),this.setPageNum(1),this.getData()},handleOpen:function(){var e=this;e.configState.operate=!0,e.updateConfig({code:"LOG_CONFIG",content:e.configState}).then(function(t){0===t.err_code?e.$Message.info("开启成功"):(e.configState.operate=!1,e.$Message.error(t.err_msg))})},handleClose:function(){var e=this;e.configState.operate=!1,e.updateConfig({code:"LOG_CONFIG",content:e.configState}).then(function(t){0===t.err_code?e.$Message.info("关闭成功"):(e.configState.operate=!0,e.$Message.error(t.err_msg))})},handleDetail:function(e){this.$refs.detailModal.init(e.id)},handleDelete:function(e){var t=this;t.$Modal.confirm({title:"确认删除",content:"<p>确认要把当前记录删除吗？</p>",loading:!0,onOk:function(){t.delete([e.id]).then(function(e){t.$Modal.remove(),0===e.err_code?(t.$Message.info("删除成功"),t.pageNum>1&&1===t.pageList.length&&t.setPageNum(t.pageNum-1),t.getData()):t.$Message.error(e.err_msg)})}})},handleDeleteBatch:function(){var e=this;e.$Modal.confirm({title:"确认删除",content:"<p>确认要把勾选的全部记录删除吗？</p>",loading:!0,onOk:function(){var t=e.$refs.selection.getSelection().map(function(e){return e.id});e.delete(t).then(function(t){e.$Modal.remove(),0===t.err_code?(e.$Message.info("删除成功"),e.pageNum>1&&1===e.pageList.length&&e.setPageNum(e.pageNum-1),e.getData()):e.$Message.error(t.err_msg)})}})}})},v=_,y=Object(g["a"])(v,r,s,!1,null,"7cf7f3f6",null);t["default"]=y.exports}}]);