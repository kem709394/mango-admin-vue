(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d216d39"],{c3b5:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[r("Icon",{attrs:{type:"ios-list-box"}}),e._v("文件列表\n    ")],1),r("Row",[r("Col",{attrs:{span:"12"}},[r("Input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{clearable:"",placeholder:"请输入名称搜搜..."},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}}),r("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-search"},on:{click:e.handleSearch}}),r("Button",{attrs:{type:"text",size:"small",icon:"ios-funnel"},on:{click:e.handleFilter}}),r("Button",{attrs:{type:"text",size:"small",icon:"ios-refresh-circle"},on:{click:e.handleRefresh}}),e.$checkAccess("sys_file_config")?r("Button",{staticStyle:{"margin-left":"20px"},on:{click:e.handleConfig}},[e._v("设置")]):e._e()],1),r("Col",{staticStyle:{"text-align":"right"},attrs:{span:"12"}},[e.$checkAccess("sys_file_upload")?r("Upload",{ref:"upload",staticStyle:{display:"inline"},attrs:{action:e.action,headers:e.headers,"show-upload-list":!1,"on-success":e.handleSuccess,"on-error":e.handleError}},[r("Button",{attrs:{type:"success"}},[e._v("上传")])],1):e._e(),e.$checkAccess("sys_file_delete")?r("Button",{staticStyle:{"margin-left":"5px"},attrs:{type:"error",disabled:!e.deleteBatch},on:{click:e.handleDeleteBatch}},[e._v("删除")]):e._e()],1)],1),r("Row",e._l(e.searchTag,function(t,a){return r("Tag",{key:a},[e._v(e._s(t))])}),1),r("Row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:1}},[r("Table",{ref:"selection",attrs:{border:"",columns:e.columns,data:e.pageList,loading:e.pageLoading},on:{"on-selection-change":e.handleSelect}})],1),r("Row",{staticStyle:{"margin-top":"10px"}},[r("Page",{attrs:{current:e.pageNum,total:e.pageTotal,"page-size":e.pageRows,"show-sizer":""},on:{"on-change":e.handleChangePage,"on-page-size-change":e.handleChangePageSize}})],1)],1),r("Modal",{attrs:{title:"高级搜索"},on:{"on-ok":e.handleSearch},model:{value:e.searchVisible,callback:function(t){e.searchVisible=t},expression:"searchVisible"}},[r("Form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":100}},[r("FormItem",{attrs:{label:"名称"}},[r("Input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"Enter something..."},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),r("FormItem",{attrs:{label:"日期"}},[r("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"daterange",placeholder:"Select date"},model:{value:e.searchForm.daterange,callback:function(t){e.$set(e.searchForm,"daterange",t)},expression:"searchForm.daterange"}})],1)],1)],1),r("FileDetail",{ref:"detailModal"}),r("FileConfig",{ref:"configModal"})],1)},o=[],s=(r("8e6e"),r("ac6a"),r("456d"),r("7f7f"),r("bd86")),n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",{attrs:{title:"文件详情","footer-hide":""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.detail?r("Form",{attrs:{"label-width":100}},[r("FormItem",{attrs:{label:"uuid"}},[e._v(e._s(e.detail.uuid))]),r("FormItem",{attrs:{label:"名称"}},[e._v(e._s(e.detail.name))]),r("FormItem",{attrs:{label:"类型"}},[e._v(e._s(e.detail.type))]),r("FormItem",{attrs:{label:"地址"}},[r("a",{attrs:{href:e.detail.url}},[r("span",[e._v(e._s(e.detail.url))])])]),r("FormItem",{attrs:{label:"大小"}},[e._v(e._s(e.detail.size)+"B")]),r("FormItem",{attrs:{label:"存储"}},[e._v(e._s(e.$tranDictName("STORE_MODE",e.detail.store)))]),r("FormItem",{attrs:{label:"上传"}},[e._v(e._s(e.$moment(e.detail.createTime).format("YYYY-MM-DD HH:mm")))])],1):e._e()],1)},i=[],l=r("2f62");function c(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(r,!0).forEach(function(t){Object(s["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var d={data:function(){return{visible:!1,detail:null}},methods:m({},Object(l["b"])("sys/file",["getDetail"]),{init:function(e){var t=this;this.getDetail(e).then(function(e){t.detail=e.info,t.visible=!0})}})},u=d,p=r("2877"),f=Object(p["a"])(u,n,i,!1,null,null,null),h=f.exports,g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",{attrs:{title:"存储设置"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("Form",{directives:[{name:"show",rawName:"v-show",value:"local"===e.mode,expression:"mode==='local'"}],ref:"form1",attrs:{model:e.form1,rules:e.rules1,"label-width":120}},[r("FormItem",{attrs:{label:"方式"}},[r("RadioGroup",{attrs:{type:"button"},model:{value:e.mode,callback:function(t){e.mode=t},expression:"mode"}},[r("Radio",{attrs:{label:"local"}},[e._v("本地")]),r("Radio",{attrs:{label:"aliyun"}},[e._v("阿里云")]),r("Radio",{attrs:{label:"qcloud"}},[e._v("腾讯云")])],1)],1),r("FormItem",{attrs:{label:"访问域名",prop:"domain"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form1.domain,callback:function(t){e.$set(e.form1,"domain",t)},expression:"form1.domain"}})],1),r("FormItem",{attrs:{label:"路径前缀",prop:"pathPrefix"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form1.pathPrefix,callback:function(t){e.$set(e.form1,"pathPrefix",t)},expression:"form1.pathPrefix"}})],1),r("FormItem",{attrs:{label:"存储目录",prop:"storeDirectory"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form1.storeDirectory,callback:function(t){e.$set(e.form1,"storeDirectory",t)},expression:"form1.storeDirectory"}})],1)],1),r("Form",{directives:[{name:"show",rawName:"v-show",value:"aliyun"===e.mode,expression:"mode==='aliyun'"}],ref:"form2",attrs:{model:e.form2,rules:e.rules2,"label-width":120}},[r("FormItem",{attrs:{label:"方式"}},[r("RadioGroup",{attrs:{type:"button"},model:{value:e.mode,callback:function(t){e.mode=t},expression:"mode"}},[r("Radio",{attrs:{label:"local"}},[e._v("本地")]),r("Radio",{attrs:{label:"aliyun"}},[e._v("阿里云")]),r("Radio",{attrs:{label:"qcloud"}},[e._v("腾讯云")])],1)],1),r("FormItem",{attrs:{label:"访问域名",prop:"domain"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form2.domain,callback:function(t){e.$set(e.form2,"domain",t)},expression:"form2.domain"}})],1),r("FormItem",{attrs:{label:"路径前缀",prop:"pathPrefix"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form2.pathPrefix,callback:function(t){e.$set(e.form2,"pathPrefix",t)},expression:"form2.pathPrefix"}})],1),r("FormItem",{attrs:{label:"Endpoint",prop:"endpoint"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form2.endpoint,callback:function(t){e.$set(e.form2,"endpoint",t)},expression:"form2.endpoint"}})],1),r("FormItem",{attrs:{label:"AccessKeyId",prop:"accessKeyId"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form2.accessKeyId,callback:function(t){e.$set(e.form2,"accessKeyId",t)},expression:"form2.accessKeyId"}})],1),r("FormItem",{attrs:{label:"AccessKeySecret",prop:"accessKeySecret"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form2.accessKeySecret,callback:function(t){e.$set(e.form2,"accessKeySecret",t)},expression:"form2.accessKeySecret"}})],1),r("FormItem",{attrs:{label:"BucketName",prop:"bucketName"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form2.bucketName,callback:function(t){e.$set(e.form2,"bucketName",t)},expression:"form2.bucketName"}})],1)],1),r("Form",{directives:[{name:"show",rawName:"v-show",value:"qcloud"===e.mode,expression:"mode==='qcloud'"}],ref:"form3",attrs:{model:e.form3,rules:e.rules3,"label-width":120}},[r("FormItem",{attrs:{label:"方式"}},[r("RadioGroup",{attrs:{type:"button"},model:{value:e.mode,callback:function(t){e.mode=t},expression:"mode"}},[r("Radio",{attrs:{label:"local"}},[e._v("本地")]),r("Radio",{attrs:{label:"aliyun"}},[e._v("阿里云")]),r("Radio",{attrs:{label:"qcloud"}},[e._v("腾讯云")])],1)],1),r("FormItem",{attrs:{label:"访问域名",prop:"domain"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form3.domain,callback:function(t){e.$set(e.form3,"domain",t)},expression:"form3.domain"}})],1),r("FormItem",{attrs:{label:"路径前缀",prop:"pathPrefix"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form3.pathPrefix,callback:function(t){e.$set(e.form3,"pathPrefix",t)},expression:"form3.pathPrefix"}})],1),r("FormItem",{attrs:{label:"AppId",prop:"appId"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form3.appId,callback:function(t){e.$set(e.form3,"appId",t)},expression:"form3.appId"}})],1),r("FormItem",{attrs:{label:"SecretId",prop:"secretId"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form3.secretId,callback:function(t){e.$set(e.form3,"secretId",t)},expression:"form3.secretId"}})],1),r("FormItem",{attrs:{label:"SecretKey",prop:"secretKey"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form3.secretKey,callback:function(t){e.$set(e.form3,"secretKey",t)},expression:"form3.secretKey"}})],1),r("FormItem",{attrs:{label:"Region",prop:"region"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form3.region,callback:function(t){e.$set(e.form3,"region",t)},expression:"form3.region"}})],1),r("FormItem",{attrs:{label:"BucketName",prop:"bucketName"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form3.bucketName,callback:function(t){e.$set(e.form3,"bucketName",t)},expression:"form3.bucketName"}})],1)],1),r("Row",{attrs:{slot:"footer",type:"flex",justify:"center"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确认")]),r("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1)},b=[];function y(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(r,!0).forEach(function(t){Object(s["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var x={data:function(){return{visible:!1,content:null,mode:"local",form1:{domain:"",pathPrefix:"",storeDirectory:""},rules1:{domain:[{required:!0,message:"访问域名不能为空",trigger:"blur"}],storeDirectory:[{required:!0,message:"存储目录不能为空",trigger:"blur"}]},form2:{domain:"",pathPrefix:"",endpoint:"",accessKeyId:"",accessKeySecret:"",bucketName:""},rules2:{domain:[{required:!0,message:"访问域名不能为空",trigger:"blur"}],endpoint:[{required:!0,message:"Endpoint不能为空",trigger:"blur"}],accessKeyId:[{required:!0,message:"AccessKeyId不能为空",trigger:"blur"}],accessKeySecret:[{required:!0,message:"AccessKeySecret不能为空",trigger:"blur"}],bucketName:[{required:!0,message:"BucketName不能为空",trigger:"blur"}]},form3:{domain:"",pathPrefix:"",appId:"",secretId:"",secretKey:"",region:"",bucketName:""},rules3:{domain:[{required:!0,message:"访问域名不能为空",trigger:"blur"}],appId:[{required:!0,message:"AppId不能为空",trigger:"blur"}],secretId:[{required:!0,message:"SecretId不能为空",trigger:"blur"}],secretKey:[{required:!0,message:"SecretKey不能为空",trigger:"blur"}],region:[{required:!0,message:"Region不能为空",trigger:"blur"}],bucketName:[{required:!0,message:"BucketName不能为空",trigger:"blur"}]}}},methods:v({},Object(l["b"])("sys/config",["getContent","updateContent"]),{init:function(){var e=this;this.getContent("STORE_CONFIG").then(function(t){e.content=t.info,e.mode=e.content.mode,"local"===e.mode?(e.form1.domain=e.content.local.domain,e.form1.pathPrefix=e.content.local.pathPrefix,e.form1.storeDirectory=e.content.local.storeDirectory):"aliyun"===e.mode?(e.form2.domain=e.content.aliyun.domain,e.form2.pathPrefix=e.content.aliyun.pathPrefix,e.form2.endpoint=e.content.aliyun.endpoint,e.form2.accessKeyId=e.content.aliyun.accessKeyId,e.form2.accessKeySecret=e.content.aliyun.accessKeySecret,e.form2.bucketName=e.content.aliyun.bucketName):"qcloud"===e.mode&&(e.form3.domain=e.content.qcloud.domain,e.form3.pathPrefix=e.content.qcloud.pathPrefix,e.form3.appId=e.content.qcloud.appId,e.form3.secretId=e.content.qcloud.secretId,e.form3.secretKey=e.content.qcloud.secretKey,e.form3.region=e.content.qcloud.region,e.form3.bucketName=e.content.qcloud.bucketName),e.visible=!0})},handleSubmit:function(){var e=this;"local"===e.mode?e.$refs.form1.validate(function(t){t&&e.updateContent({code:"STORE_CONFIG",content:{mode:"local",local:e.form1}}).then(function(t){0===t.err_code?(e.$Message.success("操作成功"),e.visible=!1):e.$Message.error(t.err_msg)})}):"aliyun"===e.mode?e.$refs.form2.validate(function(t){t&&e.updateContent({code:"STORE_CONFIG",content:{mode:"aliyun",aliyun:e.form2}}).then(function(t){0===t.err_code?(e.$Message.success("操作成功"),e.visible=!1):e.$Message.error(t.err_msg)})}):"qcloud"===e.mode&&e.$refs.form3.validate(function(t){t&&e.updateContent({code:"STORE_CONFIG",content:{mode:"qcloud",qcloud:e.form3}}).then(function(t){0===t.err_code?(e.$Message.success("操作成功"),e.visible=!1):e.$Message.error(t.err_msg)})})}})},I=x,w=Object(p["a"])(I,g,b,!1,null,null,null),k=w.exports,F=r("c276");function O(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(r,!0).forEach(function(t){Object(s["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var S={name:"sys_file",components:{FileDetail:h,FileConfig:k},data:function(){var e=this;return{action:"",headers:{},deleteBatch:!1,searchVisible:!1,searchForm:{name:"",daterange:null},searchTag:[],columns:[{type:"selection",width:60,align:"center"},{title:"名称",key:"name"},{title:"类型",key:"type"},{title:"大小",render:function(e,t){return t.row.size>1024?t.row.size>1048576?e("span",(t.row.size/1048576).toFixed(2)+"MB"):e("span",(t.row.size/1024).toFixed(1)+"KB"):e("span",t.row.size+"B")}},{title:"时间",render:function(t,r){return t("span",e.$moment(r.row.createTime).format("YYYY-MM-DD HH:mm"))}},{title:"操作",width:140,align:"center",render:function(t,r){var a=[];return e.$checkAccess("sys_file_detail")&&a.push(t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.handleDetail(r.row)}}},"详情")),e.$checkAccess("sys_file_delete")&&a.push(t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.handleDelete(r.row)}}},"删除")),t("div",a)}}]}},computed:_({},Object(l["c"])("sys/file",["pageFilter","pageNum","pageRows","pageList","pageTotal","pageLoading"])),created:function(){this.headers.Token=Object(F["n"])(),this.action="".concat(Object(F["d"])(),"/v1/sys/file")},mounted:function(){this.init()},methods:_({},Object(l["b"])("sys/file",["getData","delete"]),{},Object(l["d"])("sys/file",["setPageNum","setPageRows","setPageFilter"]),{init:function(){this.getData()},handleSuccess:function(e,t){this.$Message.success("上传成功！"),this.getData()},handleError:function(){this.$Message.error("上传失败！")},handleSelect:function(){this.$refs.selection.getSelection().length>0?this.deleteBatch=!0:this.deleteBatch=!1},handleChangePage:function(e){this.setPageNum(e),this.getData()},handleChangePageSize:function(e){this.setPageNum(1),this.setPageRows(e),this.getData()},handleFilter:function(){this.searchVisible=!0},handleSearch:function(){this.searchTag=[];var e={};""!==this.searchForm.name.trim()&&(e.name=this.searchForm.name.trim(),this.searchTag.push("名称："+this.searchForm.name.trim())),this.searchForm.daterange&&this.searchForm.daterange[0]&&(e.dateRange=this.searchForm.daterange,this.searchTag.push("日期："+this.$moment(this.searchForm.daterange[0]).format("YYYY-MM-DD")+"至"+this.$moment(this.searchForm.daterange[1]).format("YYYY-MM-DD"))),this.setPageFilter(e),this.setPageNum(1),this.getData()},handleRefresh:function(){this.searchTag=[],this.searchForm.name="",this.searchForm.daterange=null,this.setPageFilter({}),this.setPageNum(1),this.getData()},handleDetail:function(e){this.$refs.detailModal.init(e.id)},handleConfig:function(){this.$refs.configModal.init()},handleDelete:function(e){var t=this;t.$Modal.confirm({title:"确认删除",content:"<p>确认要把当前文件删除吗？</p>",loading:!0,onOk:function(){t.delete([e.id]).then(function(e){t.$Modal.remove(),0===e.err_code?(t.$Message.info("删除成功"),t.pageNum>1&&1===t.pageList.length&&t.setPageNum(t.pageNum-1),t.getData()):t.$Message.error(e.err_msg)})}})},handleDeleteBatch:function(){var e=this;e.$Modal.confirm({title:"确认删除",content:"<p>确认要把勾选的全部文件删除吗？</p>",loading:!0,onOk:function(){var t=e.$refs.selection.getSelection().map(function(e){return e.id});e.delete(t).then(function(t){e.$Modal.remove(),0===t.err_code?(e.$Message.info("删除成功"),e.pageNum>1&&1===e.pageList.length&&e.setPageNum(e.pageNum-1),e.getData()):e.$Message.error(t.err_msg)})}})}})},P=S,$=Object(p["a"])(P,a,o,!1,null,"14fd021d",null);t["default"]=$.exports}}]);