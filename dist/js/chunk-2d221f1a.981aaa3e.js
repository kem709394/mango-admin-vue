(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d221f1a"],{cd03:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[r("Icon",{attrs:{type:"ios-list-box"}}),e._v("用户列表\n    ")],1),r("Row",[r("Col",{attrs:{span:"12"}},[r("Input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{clearable:"",placeholder:"请输入账号搜搜..."},model:{value:e.searchForm.userName,callback:function(t){e.$set(e.searchForm,"userName",t)},expression:"searchForm.userName"}}),r("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-search"},on:{click:e.handleSearch}}),r("Button",{attrs:{type:"text",size:"small",icon:"ios-funnel"},on:{click:e.handleFilter}}),r("Button",{attrs:{type:"text",size:"small",icon:"ios-refresh-circle"},on:{click:e.handleRefresh}})],1),r("Col",{staticStyle:{"text-align":"right"},attrs:{span:"12"}},[e.$checkAccess("sys_user_create")?r("Button",{attrs:{type:"success"},on:{click:e.handleCreate}},[e._v("添加")]):e._e(),e.$checkAccess("sys_user_delete")?r("Button",{staticStyle:{"margin-left":"5px"},attrs:{type:"error",disabled:!e.deleteBatch},on:{click:e.handleDeleteBatch}},[e._v("删除")]):e._e()],1)],1),r("Row",e._l(e.searchTag,function(t,a){return r("Tag",{key:a},[e._v(e._s(t))])}),1),r("Row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:1}},[r("Table",{ref:"selection",attrs:{border:"",columns:e.columns,data:e.pageList,loading:e.pageLoading},on:{"on-selection-change":e.handleSelect}})],1),r("Row",{staticStyle:{"margin-top":"10px"}},[r("Page",{attrs:{current:e.pageNum,total:e.pageTotal,"page-size":e.pageRows,"show-sizer":""},on:{"on-change":e.handleChangePage,"on-page-size-change":e.handleChangePageSize}})],1)],1),r("Modal",{attrs:{title:"高级搜索"},on:{"on-ok":e.handleSearch},model:{value:e.searchVisible,callback:function(t){e.searchVisible=t},expression:"searchVisible"}},[r("Form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":100}},[r("FormItem",{attrs:{label:"账号"}},[r("Input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"Enter something..."},model:{value:e.searchForm.userName,callback:function(t){e.$set(e.searchForm,"userName",t)},expression:"searchForm.userName"}})],1),r("FormItem",{attrs:{label:"昵称"}},[r("Input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"Enter something..."},model:{value:e.searchForm.nickName,callback:function(t){e.$set(e.searchForm,"nickName",t)},expression:"searchForm.nickName"}})],1),r("FormItem",{attrs:{label:"状态"}},[r("RadioGroup",{attrs:{type:"button"},model:{value:e.searchForm.state,callback:function(t){e.$set(e.searchForm,"state",t)},expression:"searchForm.state"}},e._l(e.$getDictOptions("USE_STATE"),function(t,a){return r("Radio",{key:a,attrs:{label:t.code}},[e._v(e._s(t.name))])}),1)],1)],1)],1),r("UserCreate",{ref:"createModal",on:{callback:e.getData}}),r("UserUpdate",{ref:"updateModal",on:{callback:e.getData}}),r("UserDetail",{ref:"detailModal"})],1)},s=[],o=(r("8e6e"),r("456d"),r("bd86")),i=(r("7f7f"),r("ac6a"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Modal",{attrs:{title:"添加用户"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":100}},[r("FormItem",{attrs:{label:"用户头像",prop:"avatar"}},[r("Avatar",{attrs:{icon:"ios-person",size:"large",src:e.form.avatar},nativeOn:{click:function(t){return e.openCropperModal(t)}}})],1),r("FormItem",{attrs:{label:"用户昵称",prop:"nickName"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"Enter something..."},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1),r("FormItem",{attrs:{label:"登录账号",prop:"userName"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"Enter something..."},model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1),r("FormItem",{attrs:{label:"登录密码",prop:"password"}},[r("Input",{staticStyle:{width:"300px"},attrs:{type:"password",placeholder:"Enter something..."},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),r("FormItem",{attrs:{label:"确认密码",prop:"password2"}},[r("Input",{staticStyle:{width:"300px"},attrs:{type:"password",placeholder:"Enter something..."},model:{value:e.form.password2,callback:function(t){e.$set(e.form,"password2",t)},expression:"form.password2"}})],1),r("FormItem",{attrs:{label:"角色配置"}},[r("Select",{staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"请选择类型"},model:{value:e.form.roles,callback:function(t){e.$set(e.form,"roles",t)},expression:"form.roles"}},e._l(e.roleOptions,function(t,a){return r("Option",{key:a,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1),r("FormItem",{attrs:{label:"状态"}},[r("RadioGroup",{attrs:{type:"button"},model:{value:e.form.state,callback:function(t){e.$set(e.form,"state",t)},expression:"form.state"}},e._l(e.$getDictOptions("USE_STATE"),function(t,a){return r("Radio",{key:a,attrs:{label:t.code}},[e._v(e._s(t.name))])}),1)],1),r("FormItem",{attrs:{label:"说明"}},[r("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"Enter something..."},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}})],1)],1),r("Row",{attrs:{slot:"footer",type:"flex",justify:"center"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确认")]),r("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1),r("upload-cropper",{ref:"cropperModal",on:{callback:e.updateAvatar}})],1)}),n=[],l=r("9230"),c=r("2f62");function m(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(r,!0).forEach(function(t){Object(o["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var p={components:{UploadCropper:l["a"]},data:function(){var e=this,t=function(t,r,a){""===r?a(new Error("登录账号不能为空")):/^[a-zA-Z0-9_]{3,16}$/.test(r)?e.getList({userName:r}).then(function(e){0===e.list.length?a():a(new Error("登录账号被使用"))}):a(new Error("登录账号必须为3~16位数字、字母字符串"))},r=function(e,t,r){""===t?r(new Error("登录密码不能为空")):t.length>=6&&t.length<=10?r():r(new Error("登录密码的长度必须为6~10位"))},a=function(t,r,a){""===r?a(new Error("确认密码不能为空")):e.form.password===r?a():a(new Error("确认密码和登录账号不一致"))};return{visible:!1,form:{avatar:"",nickName:"",userName:"",password:"",password2:"",state:"",note:"",privilege:{},extFields:{},roles:[]},rules:{avatar:[{required:!0,message:"头像不能为空",trigger:"blur"}],nickName:[{required:!0,message:"昵称不能为空",trigger:"blur"}],userName:[{required:!0,validator:t,trigger:"blur"}],password:[{required:!0,validator:r,trigger:"blur"}],password2:[{required:!0,validator:a,trigger:"blur"}]},roleOptions:[]}},methods:u({},Object(c["b"])("sys/user",["create","getList"]),{},Object(c["b"])("sys/role",{getRoleList:"getList"}),{init:function(){var e=this;this.getRoleList({}).then(function(t){e.roleOptions=t.list}),this.form.avatar="",this.form.nickName="",this.form.userName="",this.form.password="",this.form.password2="",this.form.state="1",this.form.note="",this.form.roles=[],this.visible=!0},openCropperModal:function(){this.$refs.cropperModal.init()},updateAvatar:function(e){this.form.avatar=e},handleSubmit:function(){var e=this,t=this;t.$refs.form.validate(function(r){r&&t.create({avatar:t.form.avatar,nickName:t.form.nickName,userName:t.form.userName,password:t.form.password,state:t.form.state,note:t.form.note,roles:t.form.roles,privilege:t.form.privilege,extFields:t.form.extFields}).then(function(r){0===r.err_code?(t.$emit("callback"),e.visible=!1):t.$Message.error(r.err_msg)})})}})},d=p,f=r("2877"),h=Object(f["a"])(d,i,n,!1,null,null,null),g=h.exports,b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Modal",{attrs:{title:"修改用户"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":100}},[r("FormItem",{attrs:{label:"用户头像",prop:"avatar"}},[r("Avatar",{attrs:{icon:"ios-person",size:"large",src:e.form.avatar},nativeOn:{click:function(t){return e.openCropperModal(t)}}})],1),r("FormItem",{attrs:{label:"用户昵称",prop:"nickName"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"Enter something..."},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1),r("FormItem",{attrs:{label:"登录账号",prop:"userName"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"Enter something..."},model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1),r("FormItem",{attrs:{label:"登录密码",prop:"password"}},[r("Input",{staticStyle:{width:"300px"},attrs:{type:"password",placeholder:"Enter something..."},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),r("FormItem",{attrs:{label:"确认密码",prop:"password2"}},[r("Input",{staticStyle:{width:"300px"},attrs:{type:"password",placeholder:"Enter something..."},model:{value:e.form.password2,callback:function(t){e.$set(e.form,"password2",t)},expression:"form.password2"}})],1),r("FormItem",{attrs:{label:"角色配置"}},[r("Select",{staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"请选择类型"},model:{value:e.form.roles,callback:function(t){e.$set(e.form,"roles",t)},expression:"form.roles"}},e._l(e.roleOptions,function(t,a){return r("Option",{key:a,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1),r("FormItem",{attrs:{label:"状态"}},[r("RadioGroup",{attrs:{type:"button"},model:{value:e.form.state,callback:function(t){e.$set(e.form,"state",t)},expression:"form.state"}},e._l(e.$getDictOptions("USE_STATE"),function(t,a){return r("Radio",{key:a,attrs:{label:t.code}},[e._v(e._s(t.name))])}),1)],1),r("FormItem",{attrs:{label:"说明"}},[r("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"Enter something..."},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}})],1)],1),r("Row",{attrs:{slot:"footer",type:"flex",justify:"center"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确认")]),r("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1),r("upload-cropper",{ref:"cropperModal",on:{callback:e.updateAvatar}})],1)},v=[];function w(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(r,!0).forEach(function(t){Object(o["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var k={components:{UploadCropper:l["a"]},data:function(){var e=this,t=function(t,r,a){""===r?a(new Error("登录账号不能为空")):e.detail.userName===r?a():/^[a-zA-Z0-9_]{3,16}$/.test(r)?e.getList({userName:r}).then(function(e){0===e.list.length?a():a(new Error("登录账号被使用"))}):a(new Error("登录账号必须为3~16位数字、字母字符串"))},r=function(e,t,r){""===t?r():t.length>=6&&t.length<=10?r():r(new Error("登录密码的长度必须为6~10位"))},a=function(t,r,a){e.form.password===r?a():a(new Error("确认密码和登录账号不一致"))};return{visible:!1,detail:null,form:{avatar:"",nickName:"",userName:"",password:"",password2:"",state:"",note:"",privilege:{},extFields:{},roles:[]},rules:{avatar:[{required:!0,message:"头像不能为空",trigger:"blur"}],nickName:[{required:!0,message:"昵称不能为空",trigger:"blur"}],userName:[{required:!0,validator:t,trigger:"blur"}],password:[{validator:r,trigger:"blur"}],password2:[{validator:a,trigger:"blur"}]},roleOptions:[]}},methods:y({},Object(c["b"])("sys/user",["getDetail","update","getList"]),{},Object(c["b"])("sys/role",{getRoleList:"getList"}),{init:function(e){var t=this;this.getRoleList({}).then(function(e){t.roleOptions=e.list}),this.getDetail(e).then(function(e){t.detail=e.info,t.form.avatar=t.detail.avatar,t.form.nickName=t.detail.nickName,t.form.userName=t.detail.userName,t.form.state=t.detail.state,t.form.note=t.detail.note,t.form.extFields=t.detail.extFields,t.form.roles=t.detail.roles.map(function(e){return e.id}),t.visible=!0})},openCropperModal:function(){this.$refs.cropperModal.init()},updateAvatar:function(e){this.form.avatar=e},handleSubmit:function(){var e=this;e.$refs.form.validate(function(t){t&&e.update({id:e.detail.id,data:{avatar:e.form.avatar,nickName:e.form.nickName,userName:e.form.userName,password:e.form.password,state:e.form.state,note:e.form.note,roles:e.form.roles,privilege:e.form.privilege,extFields:e.form.extFields}}).then(function(t){0===t.err_code?(e.$emit("callback"),e.visible=!1):e.$Message.error(t.err_msg)})})}})},O=k,N=Object(f["a"])(O,b,v,!1,null,null,null),_=N.exports,F=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",{attrs:{title:"用户详情","footer-hide":""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.detail?r("Form",{attrs:{"label-width":100}},[r("FormItem",{attrs:{label:"头像"}},[r("Avatar",{attrs:{size:"large",src:e.detail.avatar}})],1),r("FormItem",{attrs:{label:"昵称"}},[e._v(e._s(e.detail.nickName))]),r("FormItem",{attrs:{label:"账号"}},[e._v(e._s(e.detail.userName))]),r("FormItem",{attrs:{label:"角色"}},e._l(e.detail.roles,function(t){return r("Tag",{key:t.id},[e._v(e._s(t.name))])}),1),r("FormItem",{attrs:{label:"状态"}},[e._v(e._s(e.$tranDictName("USE_STATE",e.detail.state)))]),r("FormItem",{attrs:{label:"说明"}},[e._v(e._s(e.detail.note))]),r("FormItem",{attrs:{label:"创建"}},[e._v(e._s(e.$moment(e.detail.createTime).format("YYYY-MM-DD HH:mm")))]),e.detail.modifyTime?r("FormItem",{attrs:{label:"修改"}},[e._v(e._s(e.$moment(e.detail.modifyTime).format("YYYY-MM-DD HH:mm")))]):e._e()],1):e._e()],1)},x=[];function $(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(r,!0).forEach(function(t){Object(o["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var S={data:function(){return{visible:!1,detail:null}},methods:j({},Object(c["b"])("sys/user",["getDetail"]),{init:function(e){var t=this;this.getDetail(e).then(function(e){t.detail=e.info,t.visible=!0})}})},E=S,P=Object(f["a"])(E,F,x,!1,null,null,null),D=P.exports;function I(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(r,!0).forEach(function(t){Object(o["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var R={name:"sys_user",components:{UserCreate:g,UserUpdate:_,UserDetail:D},data:function(){var e=this;return{deleteBatch:!1,searchVisible:!1,searchForm:{userName:"",nickName:"",state:""},searchTag:[],columns:[{type:"selection",width:60,align:"center"},{title:"头像",align:"center",render:function(e,t){return e("Avatar",{props:{src:t.row.avatar}})}},{title:"账号",key:"userName"},{title:"昵称",key:"nickName"},{title:"角色",render:function(e,t){var r=[];return t.row.roles.forEach(function(t){r.push(e("Tag",{props:{type:"border",color:"blue"}},t.name))}),e("div",r)}},{title:"状态",render:function(t,r){return t("span",e.$tranDictName("USE_STATE",r.row.state))}},{title:"操作",width:180,align:"center",render:function(t,r){var a=[];return e.$checkAccess("sys_user_detail")&&a.push(t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.handleDetail(r.row)}}},"详情")),e.$checkAccess("sys_user_update")&&a.push(t("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.handleUpdate(r.row)}}},"修改")),e.$checkAccess("sys_user_delete")&&a.push(t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.handleDelete(r.row)}}},"删除")),t("div",a)}}]}},computed:M({},Object(c["c"])("sys/user",["pageFilter","pageNum","pageRows","pageList","pageTotal","pageLoading"])),mounted:function(){this.init()},methods:M({},Object(c["b"])("sys/user",["getData","delete"]),{},Object(c["d"])("sys/user",["setPageNum","setPageRows","setPageFilter"]),{init:function(){this.getData()},handleSelect:function(){this.$refs.selection.getSelection().length>0?this.deleteBatch=!0:this.deleteBatch=!1},handleChangePage:function(e){this.setPageNum(e),this.getData()},handleChangePageSize:function(e){this.setPageNum(1),this.setPageRows(e),this.getData()},handleFilter:function(){this.searchVisible=!0},handleSearch:function(){this.searchTag=[];var e={};""!==this.searchForm.userName.trim()&&(e.userName=this.searchForm.userName.trim(),this.searchTag.push("账号："+this.searchForm.userName.trim())),""!==this.searchForm.nickName.trim()&&(e.nickName=this.searchForm.nickname.trim(),this.searchTag.push("昵称："+this.searchForm.nickName.trim())),""!==this.searchForm.state&&(e.state=this.searchForm.state,this.searchTag.push("状态："+this.$tranDictName("USE_STATE",this.searchForm.state))),this.setPageFilter(e),this.setPageNum(1),this.getData()},handleRefresh:function(){this.searchTag=[],this.searchForm.nickName="",this.searchForm.nickName="",this.searchForm.state="",this.setPageFilter({}),this.setPageNum(1),this.getData()},handleCreate:function(){this.$refs.createModal.init()},handleUpdate:function(e){this.$refs.updateModal.init(e.id)},handleDetail:function(e){this.$refs.detailModal.init(e.id)},handleDelete:function(e){var t=this;t.$Modal.confirm({title:"确认删除",content:"<p>确认要把当前用户删除吗？</p>",loading:!0,onOk:function(){t.delete([e.id]).then(function(e){t.$Modal.remove(),0===e.err_code?(t.$Message.info("删除成功"),t.pageNum>1&&1===t.pageList.length&&t.setPageNum(t.pageNum-1),t.getData()):t.$Message.error(e.err_msg)})}})},handleDeleteBatch:function(){var e=this;e.$Modal.confirm({title:"确认删除",content:"<p>确认要把勾选的全部用户删除吗？</p>",loading:!0,onOk:function(){var t=e.$refs.selection.getSelection().map(function(e){return e.id});e.delete(t).then(function(t){e.$Modal.remove(),0===t.err_code?(e.$Message.info("删除成功"),e.pageNum>1&&1===e.pageList.length&&e.setPageNum(e.pageNum-1),e.getData()):e.$Message.error(t.err_msg)})}})}})},T=R,A=Object(f["a"])(T,a,s,!1,null,"0a826e81",null);t["default"]=A.exports}}]);