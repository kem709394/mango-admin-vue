(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d229d2c"],{dea6:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[r("Icon",{attrs:{type:"ios-list-box"}}),e._v("邮件消息\n    ")],1),r("Row",[r("Col",{attrs:{span:"12"}},[r("Input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{clearable:"",placeholder:"请输入主题搜搜..."},model:{value:e.searchForm.subject,callback:function(t){e.$set(e.searchForm,"subject",t)},expression:"searchForm.subject"}}),r("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-search"},on:{click:e.handleSearch}}),r("Button",{attrs:{type:"text",size:"small",icon:"ios-funnel"},on:{click:e.handleFilter}}),r("Button",{attrs:{type:"text",size:"small",icon:"ios-refresh-circle"},on:{click:e.handleRefresh}}),e.$checkAccess("sys_mail_config")?r("Button",{staticStyle:{"margin-left":"20px"},on:{click:e.handleConfig}},[e._v("设置")]):e._e()],1),r("Col",{staticStyle:{"text-align":"right"},attrs:{span:"12"}},[e.$checkAccess("sys_mail_send")?r("Button",{attrs:{type:"success"},on:{click:e.handleSend}},[e._v("发送")]):e._e(),e.$checkAccess("sys_mail_delete")?r("Button",{staticStyle:{"margin-left":"5px"},attrs:{type:"error",disabled:!e.deleteBatch},on:{click:e.handleDeleteBatch}},[e._v("删除")]):e._e()],1)],1),r("Row",e._l(e.searchTag,function(t,a){return r("Tag",{key:a},[e._v(e._s(t))])}),1),r("Row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:1}},[r("Table",{ref:"selection",attrs:{border:"",columns:e.columns,data:e.pageList,loading:e.pageLoading},on:{"on-selection-change":e.handleSelect}})],1),r("Row",{staticStyle:{"margin-top":"10px"}},[r("Page",{attrs:{current:e.pageNum,total:e.pageTotal,"page-size":e.pageRows,"show-sizer":""},on:{"on-change":e.handleChangePage,"on-page-size-change":e.handleChangePageSize}})],1)],1),r("Modal",{attrs:{title:"高级搜索"},on:{"on-ok":e.handleSearch},model:{value:e.searchVisible,callback:function(t){e.searchVisible=t},expression:"searchVisible"}},[r("Form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":100}},[r("FormItem",{attrs:{label:"主题"}},[r("Input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"Enter something..."},model:{value:e.searchForm.subject,callback:function(t){e.$set(e.searchForm,"subject",t)},expression:"searchForm.subject"}})],1),r("FormItem",{attrs:{label:"状态"}},[r("Select",{staticStyle:{width:"300px"},attrs:{clearable:""},model:{value:e.searchForm.state,callback:function(t){e.$set(e.searchForm,"state",t)},expression:"searchForm.state"}},e._l(e.$getDictOptions("MAIL_STATE"),function(t,a){return r("Option",{key:a,attrs:{value:t.code}},[e._v(e._s(t.name))])}),1)],1),r("FormItem",{attrs:{label:"日期"}},[r("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"daterange",placeholder:"Select date"},model:{value:e.searchForm.daterange,callback:function(t){e.$set(e.searchForm,"daterange",t)},expression:"searchForm.daterange"}})],1)],1)],1),r("MailSend",{ref:"sendModal",on:{callback:e.getData}}),r("MailDetail",{ref:"detailModal"}),r("MailConfig",{ref:"configModal"})],1)},n=[],s=(r("8e6e"),r("456d"),r("bd86")),o=(r("ac6a"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",{attrs:{title:"发送邮件",width:"800"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":150}},[r("FormItem",{attrs:{label:"主题",prop:"subject"}},[r("Input",{staticStyle:{width:"500px"},attrs:{placeholder:"请填写内容..."},model:{value:e.form.subject,callback:function(t){e.$set(e.form,"subject",t)},expression:"form.subject"}})],1),r("FormItem",{attrs:{label:"接收",prop:"toSite"}},[r("MailsInput",{model:{value:e.form.toSite,callback:function(t){e.$set(e.form,"toSite",t)},expression:"form.toSite"}})],1),r("FormItem",{attrs:{label:"抄送",prop:"ccSite"}},[r("MailsInput",{model:{value:e.form.ccSite,callback:function(t){e.$set(e.form,"ccSite",t)},expression:"form.ccSite"}})],1),r("FormItem",{attrs:{label:"内容",prop:"content"}},[r("Input",{staticStyle:{width:"500px"},attrs:{type:"textarea",autosize:{minRows:8,maxRows:20},placeholder:"请填写内容..."},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)],1),r("Row",{attrs:{slot:"footer",type:"flex",justify:"center"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确认")]),r("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1)}),i=[],c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e._l(e.tags,function(t,a){return r("Tag",{key:a,attrs:{closable:""},on:{"on-close":e.del}},[e._v(e._s(t))])}),r("Input",{ref:"input",staticStyle:{width:"200px"},attrs:{placeholder:"请输入后按回车键"},on:{"on-enter":e.add},model:{value:e.current,callback:function(t){e.current=t},expression:"current"}})],2)},l=[],u={props:{value:Array,required:!0,default:function(){return[]}},data:function(){return{current:""}},computed:{tags:function(){return this.value.slice()}},methods:{add:function(e){var t=e.target.value;t?this.tags.indexOf(t)>-1?this.$Message.error("邮箱地址重复"):/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/.test(t)?(this.tags.push(t),this.$emit("input",this.tags),this.current=""):this.$Message.error("邮箱地址格式错误"):this.$Message.error("邮箱地址不能为空")},del:function(e,t){var r=this.tags.indexOf(t);this.tags.splice(r,1),this.$emit("input",this.tags)}}},m=u,h=r("2877"),p=Object(h["a"])(m,c,l,!1,null,null,null),d=p.exports,f=r("2f62");function g(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(r,!0).forEach(function(t){Object(s["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var y={components:{MailsInput:d},data:function(){return{visible:!1,form:{subject:"",content:"",toSite:[],ccSite:[],inline:[],attachment:[]},rules:{subject:[{required:!0,message:"主题不能为空",trigger:"blur"}],content:[{required:!0,message:"内容不能为空",trigger:"blur"}],toSite:[{required:!0,type:"array",message:"至少填写一个接收地址",trigger:"blur"}]}}},methods:b({},Object(f["b"])("sys/mail",["create"]),{init:function(){this.form.subject="",this.form.content="",this.form.toSite=[],this.form.ccSite=[],this.visible=!0},handleSubmit:function(){var e=this;e.$refs.form.validate(function(t){t&&e.create({subject:e.form.subject,content:e.form.content,toSite:e.form.toSite,ccSite:e.form.ccSite,inline:[],attachment:[]}).then(function(t){0===t.err_code?(e.$emit("callback"),e.visible=!1):e.$Message.error(t.err_msg)})})}})},v=y,w=Object(h["a"])(v,o,i,!1,null,null,null),O=w.exports,_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",{attrs:{title:"消息详情","footer-hide":""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.detail?r("Form",{attrs:{"label-width":100}},[r("FormItem",{attrs:{label:"主题"}},[e._v(e._s(e.detail.subject))]),r("FormItem",{attrs:{label:"内容"}},[e._v(e._s(e.detail.content))]),r("FormItem",{attrs:{label:"接收"}},e._l(e.detail.toSite,function(t){return r("Tag",{key:t},[e._v(e._s(t))])}),1),e.detail.ccSite.length>0?r("FormItem",{attrs:{label:"抄送"}},e._l(e.detail.ccSite,function(t){return r("Tag",{key:t},[e._v(e._s(t))])}),1):e._e(),r("FormItem",{attrs:{label:"状态"}},[e._v("\n      "+e._s(e.$tranDictName("MAIL_STATE",e.detail.state))+"\n      "),"-1"===e.detail.state?[e._v(e._s(e.detail.counter)+"次")]:e._e()],2),"1"===e.detail.state||"-1"===e.detail.state?r("FormItem",{attrs:{label:"发送"}},[e._v(e._s(e.$moment(e.detail.sendTime).format("YYYY-MM-DD HH:mm")))]):e._e(),r("FormItem",{attrs:{label:"创建"}},[e._v(e._s(e.$moment(e.detail.createTime).format("YYYY-MM-DD HH:mm")))])],1):e._e()],1)},j=[];function S(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(r,!0).forEach(function(t){Object(s["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var k={data:function(){return{visible:!1,detail:null}},methods:$({},Object(f["b"])("sys/mail",["getDetail"]),{init:function(e){var t=this;this.getDetail(e).then(function(e){t.detail=e.info,t.visible=!0})}})},F=k,M=Object(h["a"])(F,_,j,!1,null,null,null),x=M.exports,D=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",{attrs:{title:"邮件设置"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":120}},[r("FormItem",{attrs:{label:"邮箱主机",prop:"host"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写邮箱主机..."},model:{value:e.form.host,callback:function(t){e.$set(e.form,"host",t)},expression:"form.host"}})],1),r("FormItem",{attrs:{label:"邮箱端口",prop:"port"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写邮箱端口..."},model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",t)},expression:"form.port"}})],1),r("FormItem",{attrs:{label:"邮箱账号",prop:"username"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写邮箱账号..."},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),r("FormItem",{attrs:{label:"邮箱密码",prop:"password"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写邮箱密码..."},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),r("FormItem",{attrs:{label:"默认邮箱",prop:"sender"}},[r("Input",{staticStyle:{width:"300px"},attrs:{placeholder:"请填写默认邮箱..."},model:{value:e.form.sender,callback:function(t){e.$set(e.form,"sender",t)},expression:"form.sender"}})],1)],1),r("Row",{attrs:{slot:"footer",type:"flex",justify:"center"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确认")]),r("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")])],1)],1)},P=[];function I(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(r,!0).forEach(function(t){Object(s["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var A={data:function(){return{visible:!1,content:null,form:{host:"",port:"",username:"",password:"",sender:""},rules:{host:[{required:!0,message:"邮箱主机不能为空",trigger:"blur"}],port:[{required:!0,message:"邮箱端口不能为空",trigger:"blur"}],username:[{required:!0,message:"邮箱账号不能为空",trigger:"blur"}],password:[{required:!0,message:"邮箱密码不能为空",trigger:"blur"}],sender:[{required:!0,message:"默认邮箱不能为空",trigger:"blur"}]}}},methods:T({},Object(f["b"])("sys/config",["getContent","updateContent"]),{init:function(){var e=this;this.getContent("MAIL_CONFIG").then(function(t){e.content=t.info,e.form.host=e.content.host,e.form.port=e.content.port,e.form.username=e.content.username,e.form.password=e.content.password,e.form.sender=e.content.sender,e.visible=!0})},handleSubmit:function(){var e=this;e.$refs.form.validate(function(t){t&&e.updateContent({code:"MAIL_CONFIG",content:e.form}).then(function(t){0===t.err_code?(e.$Message.success("操作成功"),e.visible=!1):e.$Message.error(t.err_msg)})})}})},B=A,R=Object(h["a"])(B,D,P,!1,null,null,null),Y=R.exports;function C(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(r,!0).forEach(function(t){Object(s["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var N={name:"sys_mail",components:{MailSend:O,MailDetail:x,MailConfig:Y},data:function(){var e=this;return{deleteBatch:!1,searchVisible:!1,searchForm:{subject:"",state:"",daterange:null},searchTag:[],columns:[{type:"selection",width:60,align:"center"},{title:"主题",align:"center",key:"subject"},{title:"接收",align:"center",render:function(e,t){var r=[];return t.row.toSite.forEach(function(t){r.push(e("Tag",{props:{type:"border",color:"blue"}},t))}),e("div",r)}},{title:"状态",align:"center",render:function(t,r){var a=[];return a.push(t("span",e.$tranDictName("MAIL_STATE",r.row.state))),"-1"===r.row.state&&a.push(t("Tag",{props:{color:"error"},style:{marginLeft:"5px"}},"".concat(r.row.counter,"次"))),t("div",a)}},{title:"时间",align:"center",render:function(t,r){return t("span",e.$moment(r.row.createTime).format("YYYY-MM-DD HH:mm"))}},{title:"操作",width:180,align:"center",render:function(t,r){var a=[];return e.$checkAccess("sys_mail_cancel")&&("0"===r.row.state||"-1"===r.row.state&&r.row.counter<3)&&a.push(t("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){e.handleCancel(r.row)}}},"撤销")),e.$checkAccess("sys_mail_retry")&&("2"===r.row.state||"-1"===r.row.state&&3===r.row.counter)&&a.push(t("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){e.handleRetry(r.row)}}},"重发")),e.$checkAccess("sys_mail_detail")&&a.push(t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.handleDetail(r.row)}}},"详情")),e.$checkAccess("sys_mail_delete")&&a.push(t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.handleDelete(r.row)}}},"删除")),t("div",a)}}]}},computed:E({},Object(f["c"])("sys/mail",["pageFilter","pageNum","pageRows","pageList","pageTotal","pageLoading"])),mounted:function(){this.init()},methods:E({},Object(f["b"])("sys/mail",["getData","update","delete"]),{},Object(f["d"])("sys/mail",["setPageNum","setPageRows","setPageFilter"]),{init:function(){this.getData()},handleSelect:function(){this.$refs.selection.getSelection().length>0?this.deleteBatch=!0:this.deleteBatch=!1},handleChangePage:function(e){this.setPageNum(e),this.getData()},handleChangePageSize:function(e){this.setPageNum(1),this.setPageRows(e),this.getData()},handleFilter:function(){this.searchVisible=!0},handleSearch:function(){this.searchTag=[];var e={};""!==this.searchForm.subject.trim()&&(e.subject=this.searchForm.subject.trim(),this.searchTag.push("主题："+this.searchForm.subject.trim())),""!==this.searchForm.state.trim()&&(e.state=this.searchForm.state.trim(),this.searchTag.push("状态："+this.$tranDictName("MAIL_STATE",this.searchForm.state.trim()))),this.searchForm.daterange&&this.searchForm.daterange[0]&&(e.dateRange=this.searchForm.daterange,this.searchTag.push("日期："+this.$moment(this.searchForm.daterange[0]).format("YYYY-MM-DD")+"至"+this.$moment(this.searchForm.daterange[1]).format("YYYY-MM-DD"))),this.setPageFilter(e),this.setPageNum(1),this.getData()},handleRefresh:function(){this.searchTag=[],this.searchForm.subject="",this.searchForm.state="",this.searchForm.daterange=null,this.setPageFilter({}),this.setPageNum(1),this.getData()},handleSend:function(){this.$refs.sendModal.init()},handleConfig:function(){this.$refs.configModal.init()},handleDetail:function(e){this.$refs.detailModal.init(e.id)},handleRetry:function(e){var t=this;t.$Modal.confirm({title:"确认重发",content:"<p>确认要重发当前邮件吗？</p>",loading:!0,onOk:function(){t.update({id:e.id,data:{retry:!0}}).then(function(e){t.$Modal.remove(),0===e.err_code?(t.$Message.info("操作成功"),t.getData()):t.$Message.error(e.err_msg)})}})},handleCancel:function(e){var t=this;t.$Modal.confirm({title:"确认撤销",content:"<p>确认要撤销当前邮件吗？</p>",loading:!0,onOk:function(){t.update({id:e.id,data:{cancel:!0}}).then(function(e){t.$Modal.remove(),0===e.err_code?(t.$Message.info("操作成功"),t.getData()):t.$Message.error(e.err_msg)})}})},handleDelete:function(e){var t=this;t.$Modal.confirm({title:"确认删除",content:"<p>确认要把当前记录删除吗？</p>",loading:!0,onOk:function(){t.delete([e.id]).then(function(e){t.$Modal.remove(),0===e.err_code?(t.$Message.info("删除成功"),t.pageNum>1&&1===t.pageList.length&&t.setPageNum(t.pageNum-1),t.getData()):t.$Message.error(e.err_msg)})}})},handleDeleteBatch:function(){var e=this;e.$Modal.confirm({title:"确认删除",content:"<p>确认要把勾选的全部记录删除吗？</p>",loading:!0,onOk:function(){var t=e.$refs.selection.getSelection().map(function(e){return e.id});e.delete(t).then(function(t){e.$Modal.remove(),0===t.err_code?(e.$Message.info("删除成功"),e.pageNum>1&&1===e.pageList.length&&e.setPageNum(e.pageNum-1),e.getData()):e.$Message.error(t.err_msg)})}})}})},z=N,L=Object(h["a"])(z,a,n,!1,null,"0c060cb9",null);t["default"]=L.exports}}]);